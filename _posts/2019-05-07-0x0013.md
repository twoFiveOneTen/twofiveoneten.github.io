---
layout: post
title: "CentOS 7搭建nextcloud个人云盘"
date: 2019-05-07 02:56:00
categories: ["Linux", "PHP"]
tags: []
---
目前应用比较多的个人云盘有ownCloud、Seafile、nextcloud等等。nextcloud前几天发布了16.0.0版本。我也体验了一下nextcloud，这里记录一下搭建过程吧。<!--more-->nextcloud有PC客户端，其支持本地自动同步功能，有需要的同学自行尝试一下，本地客户端官方安装地址：https://nextcloud.com/install/#install-clients
> 目录

> [TOC]

## 演示环境
- CentOS 7.6
- nginx
- mysql 5.7
- PHP 7.2.18 (cli)

## 说明
1. PHP版本至少 7.1
1. 如果使用Mysql数据库，则要激活 `InnoDB`引擎（关于如何查看是否激活，以及如何把`InnoDB`设为默认引擎，可以参考本站文章 [MySQL设置 InnoDB 为默认引擎](https://zkk.me/0x0015.html "MySQL设置 InnoDB 为默认引擎"))

## 搭建云盘
#### 域名解析
先把云盘的域名解析至服务器
#### 添加数据库用户和数据库
在浏览器输入服务器ip，然后进入phpMyadmin，以root身份登录到数据库，然后点击图中红框的`账户`
[![](/img/0013/0013-1.png)](/img/0013/0013-1.png)
然后点击新增中的新增用户账户
[![](/img/0013/0013-2.png)](/img/0013/0013-2.png)
下图中的填写可以作为新增用户参考，填写完毕后点击页面右下角的执行，注意红框处的对号要勾选
[![](/img/0013/0013-3.png)](/img/0013/0013-3.png)
用户和数据库添加完毕
#### 下载nextcloud
在服务器中创建一个虚拟机，虚拟机的rewrite类型如果有nextcloud则选择nextcloud，没有的话默认即可，有需要的同学可以自行添加。这里假定域名为`cloud.zkk.me`。
进入到网站目录下(请更换为自己的目录)
```shell
cd /home/wwwroot/cloud.zkk.me
```
下载nextcloud程序，这里下载的是16.0.1，也是目前最新版。可以去官网查看最新版，官方下载站地址：[https://download.nextcloud.com/](https://download.nextcloud.com/ "https://download.nextcloud.com/")
```shell
wget https://download.nextcloud.com/server/releases/nextcloud-16.0.1.zip
```
解压压缩包并把文件移到网站目录下
```shell
unzip nextcloud*zip
mv nextcloud/* ./
```
删除没用的文件夹和压缩包
```shell
rm -rf nextcloud
rm -f nextcloud*zip
```
改变网站文件的所属用户
```shell
chown -R www:www ./*
```
#### 安装nextcloud
浏览器访问你的网盘，会要求你完成管理员的创建以及数据库的填写，如下图。
`存储&数据库`选择MySQL，然后填写刚刚创建的数据库用户和密码，以及数据库的名字，然后完成安装。
[![](/img/0013/0013-4.png)](/img/0013/0013-4.png)