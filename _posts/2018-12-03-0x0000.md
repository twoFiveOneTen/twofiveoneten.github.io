---
layout: post
title: "搭建WordPress博客"
date: 2018-12-03 03:21:00
categories: ["Linux", "PHP"]
tags: []
---
用WordPress搭建一个个人博客，在博客里写一写，记录生活的点点滴滴。适合于纯小白的教程，使用lnmp.org的lnmp一键安装脚本搭建。<!--more-->
## 您需要
- 服务器：各大服务器提供商可购得（阿里云、腾讯云等，如果服务器在中国大陆，则搭建网站前需要先进行ICP备案和公安备案，备案步骤省略）。本文演示所用系统镜像为CentOS
- 一个域名：各域名注册商可注册（阿里云、腾讯云等）

## 大致流程
1. 域名添加A类解析至服务器
1. 服务器搭建lnmp环境
1. 添加虚拟机
1. 服务器安装WordPress
1. 修改配置

## 具体步骤
- 解析域名
登录到你的域名管理界面，向你的服务器添加A类解析
- 搭建lnmp
这里我安装的是lnmp1.4，lnmp1.5也有参考，仍可以按照此教程安装
首先开启一个窗口，创建窗口的目的是在断开SSH连接后服务器仍能继续完成指定任务
```shell
screen -S lnmp
```
如果执行此指令提示`-bash: screen: command not found`
则安装screen
```shell
yum -y install screen
```
成功安装screen之后，**再次执行第一条指令**
安装lnmp1.4（如果要安装lnmp最新版，请去官网[https://lnmp.org](https://lnmp.org "https://lnmp.org")
```shell
wget http://soft.vpser.net/lnmp/lnmp1.4.tar.gz -cO lnmp1.4.tar.gz && tar zxf lnmp1.4.tar.gz && cd lnmp1.4 && ./install.sh lnmp
```
数据库可以默认（直接Enter)
![](/img/0000/0000-1.png)
然后为root创建数据库密码
![](/img/0000/0000-2.png)
![](/img/0000/0000-3.png)
PHP和Memory Allocator都可以默认，直接Enter
![](/img/0000/0000-4.png)
所有选项选择后，按任意键开始安装，这一过程会持续较长时间（30mins-40mins)，如果你等不及，你可以去喝杯茶。如果你不小心关闭了SSH连接，再次建立连接之后，输入
```shell
screen -x lnmp
```
然后你就到了之前为lnmp安装进程创建的窗口，screen的用途体现于此
看到下面这个页面，说明lnmp1.4安装成功
![](/img/0000/0000-5.png)
按Ctrl + c 退出lnmp搭建界面

- 添加虚拟机
```shell
lnmp vhost add
```
详细配置查看下图说明
![](/img/0000/0000-6.jpg)
看到这个界面说明虚拟机添加成功
![](/img/0000/0000-7.png)
- 安装WordPress
访问WordPress网站下载WordPress[https://cn.wordpress.org/download/](https://cn.wordpress.org/download/ "https://cn.wordpress.org/download/")
下载到本地，解压后得到一个名称格式为“wordpress-版本号”的文件夹，打开后里面是一个叫做wordpress的文件夹，把wordpress文件夹压缩成wordpress.zip
打开Xftp，把wordpress.zip上传到/home/wwwroot/你的域名 文件夹下
![](/img/0000/0000-8.png)
然后解压wordpress.zip
```shell
cd /home/wwwroot/你的域名
unzip wordpress.zip
```
等待解压完成,执行
```shell
mv wordpress/* .
rm -rf wordpress
rm -rf wordpress.zip
```
- 修改配置
执行完以上步骤，现在你应该可以在浏览器访问并管理你的网站，但是在某些操作中会遇到一些问题，现在改动一些配置来解决这些问题
lnmp一键安装包禁止了一些影响安全性的PHP函数，其中一个对于主题的显示造成影响，我们要解禁它
```shell
sed -i 's/,scandir//g' /usr/local/php/etc/php.ini
```

 ------------
WordPress上传主题时出现错误，要对wp-config.php做一些改动
首先找到此文件（需要你已经在你的网站上登陆过WordPress才会出现此文件）
```shell
cd /home/wwwroot/你的域名
vi wp-config.php
```
在文件末尾添加以下四行代码
```php
define("FS_METHOD", "direct");
define("FS_CHMOD_DIR", 0777);
define("FS_CHMOD_FILE", 0777);
define('CONCATENATE_SCRIPTS', false);
```
修改文件后保存，再重启PHP
```shell
service php-fpm restart
```

 ------------
更改wordpress文件所属用户，以便于WordPress更改主题/插件/图片 文件夹
```shell
chown -R www:www /home/wwwroot/你的域名
```

 ------------
为了在地址栏直接输入你的域名也能访问安全连接，需要做一下301重定向
```shell
cd /usr/local/nginx/conf/vhost
vi 你的域名.conf
```
只需更改listen 80;的代码段为如下格式
```shell
server
    {
        listen 80;
        server_name example.com www.example.com;
        return 301 https://example.com$request_uri;
    }
```
具体改法，这里以example.com为例，你可以把文件中所有这个域名替换成你的域名。一般情况下，你只需把你原来配置文件中的第一个server{}代码段中的内容全部删掉，然后把上面代码中的server{}代码段经过域名替换后，作为你的配置文件中的第一个server{}代码段即可，编辑完此配置文件后，保存
在保存上述配置文件后，重新载入nginx
```shell
service nginx reload
```

------------


现在你就可以访问你的网站并进行管理了！