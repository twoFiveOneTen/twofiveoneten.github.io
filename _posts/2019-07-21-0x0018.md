---
layout: post
title: "Aria2搭配AriaNg实现离线下载"
date: 2019-07-21 06:19:00
modified: 2021-04-05 16:13:00
slug: 0x0018
categories: []
tags: []
comments: true
views: 6094
---
Aria2是一个非常优秀的支持多种协议的轻量级命令行下载工具，优点是：多线程连线充分利用带宽；运行时不会占用过多资源，通常在 4MB~9MB；全功能 BitTorrent 客户端； 支持 RPC 界面远程控制。<!--more-->如果你不想每次下载都使用命令行，那么你可以使用AriaNg。
AriaNg是一个运行在服务端的Aria2前端管理工具，它可以不用Aria2命令就可以在网页上添加下载任务。
> 目录

> [TOC]

## 演示环境
- ```shell
[root@lax ~]# cat /etc/redhat-release
CentOS Linux release 7.6.1810 (Core)
```
- nginx/1.14.1
- PHP 7.1.18 (cli)

## Aria2
### 安装
执行命令安装
```shell
wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubi/doubi/master/aria2.sh && chmod +x aria2.sh && bash aria2.sh
```
运行脚本后可以看到如下界面
[![](/img/0018/0018-1.png)](/img/0018/0018-1.png)
如果VPS内没有安装aria2，则输入1进行安装
### 配置
输入命令编辑aira2配置文件
```shell
vi /root/.aria2/aria2.conf
```
- 保存位置
找到如下一行，将`dir`修改为文件下载保存的位置
[![](/img/0018/0018-2.png)](/img/0018/0018-2.png)
- RPC令牌
RPC令牌就相当于 Aria2(后端/服务端)远程API连接的授权密码
在aria2配置文件中找到如下图片中黄框处的一行，通过修改`rpc-secret=XXXXXXX`为RPC连接设置一个密码
[![](/img/0018/0018-3.png)](/img/0018/0018-3.png)
- 去除多余.aria2文件
如果你不想保存文件下载历史，可以修改此项。保存下载历史会在文件下载文件夹内多一个与文件同名的.aria2文件。
[![](/img/0018/0018-3.1.png)](/img/0018/0018-3.1.png)
将上图中黄框处的`force-save=true`改为`false`。
- Https连接
如果想要 AriaNg 以HTTPS形式连接Aria2，则要在配置文件中修改以下地方，如果不修改这一部分只能以HTTP方式连接Aria2。找到图片中的部分
[![](/img/0018/0018-4.png)](/img/0018/0018-4.png)
将`rpc-secure=false`修改为`rpc-secure=true`；
然后在`rpc-certificate`后面填写 SSL/TLS 加密时的证书文件路径，可以是`.pem`或`.crt`；
在`rpc-private-key`后面填写 SSL/TLS 加密时的私钥文件路径(.key)；
**记得把这两行前面原有的`#`删除。**

**修改完配置文件后，使用命令重新启动aria2**
```shell
service aria2 restart
```

## AriaNg
> 项目：https://github.com/mayswind/AriaNg
下载：https://github.com/mayswind/AriaNg/releases/latest

AriaNg是一个前端(HTML+JS静态)控制面板，不需要和 Aria2(后端/服务端)放在一个服务器或者设备中，你可以直接下载到你的本地电脑上解压打开index.html，或者放在服务器访问，服务器只要有Nginx或者Apache就可以了。
打开RPC配置界面，RPC密钥处填写你刚才设置的密码
[![](/img/0018/0018-5.png)](/img/0018/0018-5.png)
设置好后，刷新一下页面可以看到 Aria2 连接成功
[![](/img/0018/0018-6.png)](/img/0018/0018-6.png)
然后你就能在此页面进行离线下载了
[![](/img/0018/0018-7.png)](/img/0018/0018-7.png)
你还可以修改默认下载位置来搭配h5ai、Nextcloud进行更加方便的使用。

## 错误
#### AriaNg连接Aria2错误
1. 检查VPS防火墙（和安全组）是否开放端口6800和51413；6800是RPC监听端口，51413是BT监听端口。
2. 如果Aria2 RPC协议是HTTPS，则需要检查是否在aria2的配置文件中开启了Https连接的相关设置（上文有述）。如果相关证书和密钥配置错误的话，Aria2是无法成功启动的。

> REFERENCE
- [Nextcloud离线下载搭建方法-整合Aria2和AriaNg、Aria2 WebUI实现离线下载 --挖站否](https://wzfou.com/nextcloud-aria2/ "Nextcloud离线下载搭建方法-整合Aria2和AriaNg、Aria2 WebUI实现离线下载 --挖站否")